services:
  api:
    build:
      context: .
      dockerfile: Dockerfile.api
    environment:
      MODEL_PATH: ${MODEL_PATH:-/app/checkpoints/best_model.pth}
      DEVICE: ${DEVICE:-cpu}
      SEQUENCE_LENGTH: ${SEQUENCE_LENGTH:-16}
      THRESHOLD: ${THRESHOLD:-0.5}
    volumes:
      - ./checkpoints:/app/checkpoints:ro
    ports:
      - "${API_PORT:-8000}:8000"
    restart: unless-stopped

  web:
    build:
      context: ./web_ui
      dockerfile: Dockerfile
      args:
        VITE_API_URL: ${VITE_API_URL:-http://api:8000}
    depends_on:
      - api
    ports:
      - "${WEB_PORT:-5173}:80"
    restart: unless-stopped
